<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Age-uncertain correlation | Time-uncertain data analysis in R</title>
  <meta name="description" content="This book covers time-uncertain data analysis in R, primarily relying on the geoChronR package" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Age-uncertain correlation | Time-uncertain data analysis in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book covers time-uncertain data analysis in R, primarily relying on the geoChronR package" />
  <meta name="github-repo" content="linkedearth/geochronr-tutorial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Age-uncertain correlation | Time-uncertain data analysis in R" />
  
  <meta name="twitter:description" content="This book covers time-uncertain data analysis in R, primarily relying on the geoChronR package" />
  

<meta name="author" content="Nick McKay" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="inputs.html"/>
<link rel="next" href="exercise-2.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">geoChronR Tutorial</a></li>
<li><a href="http://nickmckay.github.io/GeoChronR>geoChronR manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="chapter" data-level="2" data-path="inputs.html"><a href="inputs.html"><i class="fa fa-check"></i><b>2</b> Data in geoChronR</a>
<ul>
<li class="chapter" data-level="2.1" data-path="inputs.html"><a href="inputs.html#loading-a-lipd-file"><i class="fa fa-check"></i><b>2.1</b> Loading a LiPD file</a></li>
<li class="chapter" data-level="2.2" data-path="inputs.html"><a href="inputs.html#loading-multiple-lipd-datasets"><i class="fa fa-check"></i><b>2.2</b> Loading multiple LiPD datasets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html"><i class="fa fa-check"></i><b>3</b> Age-uncertain correlation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#the-corens-function"><i class="fa fa-check"></i><b>3.1</b> The corEns() function</a></li>
<li class="chapter" data-level="3.2" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#plotting-the-results"><i class="fa fa-check"></i><b>3.2</b> Plotting the results</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#significance-testing-options"><i class="fa fa-check"></i><b>3.2.1</b> Significance testing options</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#judging-the-overall-significance-of-an-age-uncertain-correlation"><i class="fa fa-check"></i><b>3.3</b> Judging the overall significance of an age-uncertain correlation</a></li>
<li class="chapter" data-level="3.4" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#conclusions"><i class="fa fa-check"></i><b>3.4</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise-2.html"><a href="exercise-2.html"><i class="fa fa-check"></i><b>4</b> Exercise 2</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time-uncertain data analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="age-uncertain-correlation" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Age-uncertain correlation</h1>
<p>This vignette picks up where the <a href="Introduction.html">introduction</a> leaves off, we’ve generated age ensembles for two datasets, and now want to explore the relationship between these two datasets. First we’ll load the packages we need.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="age-uncertain-correlation.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoChronR)</span>
<span id="cb1-2"><a href="age-uncertain-correlation.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="age-uncertain-correlation.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code></pre></div>
<p>And the data we generated in the <a href="Introduction.html">introduction</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="age-uncertain-correlation.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loadRemote</span>(<span class="st">&quot;https://lipdverse.org/geoChronR-examples/introductionOutput.RData&quot;</span>,<span class="at">useSavedNames =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div id="the-corens-function" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> The corEns() function</h2>
<p>Let’s take another look at the the two timeseries over the period of overlap.
To calculate age uncertian correlation let use geoChronR’s <code>corEns</code> function.
Note that this approach is, in many ways, simplistic.
Correlating the two age-uncertain datasets will characterize the relationship, but ignores ancillary evidence that may support a mechanistic relationship between two timeseries.
Still, it illustrates how age uncertainty can affect apparent alignment between two datasets, which is the purpose of this example.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="age-uncertain-correlation.html#cb3-1" aria-hidden="true" tabindex="-1"></a>corout <span class="ot">&lt;-</span> <span class="fu">corEns</span>(<span class="at">time.1 =</span> gisp2.ens,</span>
<span id="cb3-2"><a href="age-uncertain-correlation.html#cb3-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values.1 =</span> gisp2.d18O,</span>
<span id="cb3-3"><a href="age-uncertain-correlation.html#cb3-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">time.2 =</span> hulu.ae,</span>
<span id="cb3-4"><a href="age-uncertain-correlation.html#cb3-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values.2 =</span> hulu.d18O,</span>
<span id="cb3-5"><a href="age-uncertain-correlation.html#cb3-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bin.step =</span> <span class="dv">200</span>,</span>
<span id="cb3-6"><a href="age-uncertain-correlation.html#cb3-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">max.ens =</span> <span class="dv">1000</span>,</span>
<span id="cb3-7"><a href="age-uncertain-correlation.html#cb3-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">isopersistent  =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-8"><a href="age-uncertain-correlation.html#cb3-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">isospectral =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-9"><a href="age-uncertain-correlation.html#cb3-9" aria-hidden="true" tabindex="-1"></a>                 <span class="at">gaussianize =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Note that there are many parameters available for the <code>corEns</code> function (check out the help at <code>?corEns</code>).
Some of the key ones to pay attention to are:</p>
<ul>
<li><p><strong>bin.step</strong> This variable sets the size of the bins that the data will be averaged into to align before correlation. Smaller bins will focus allow examination of shorter timescales, and increase the the sample size, but also increase the number of empty bins, and tend to increase autocorrelation. The right bin size varies depends on the distribution of resolutions in your datasets.</p></li>
<li><p><strong>isopersistent</strong> and <strong>isospectral</strong> These need to be set to TRUE if you want to calculate null significance models for significance testing with these methods. On the other hand, turning it off will speed up calculation if you don’t need it.</p></li>
<li><p><strong>gaussianize</strong> You’ll find the gaussianize option throughout geoChronR, and it’s typically the default option. <code>gaussianize</code> will transform the data into a Gaussian distribution, recognizing that many of the methods and/or their significance testing assume that the input data are normally distributed. This options ensures that this is the case.</p></li>
</ul>
<p><code>corEns</code> returns a list that has the key correlation and significance results for all the selected methods.
If percentiles are provided to corEns, and they are by default, the function will output a data.frame that summarizes the output.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="age-uncertain-correlation.html#cb4-1" aria-hidden="true" tabindex="-1"></a>corout<span class="sc">$</span>cor.stats</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;cli&#39;:
##   method     from         
##   print.boxx spatstat.geom</code></pre>
<pre><code>## # A tibble: 5 x 6
##   percentiles       r pSerial    pRaw pIsopersistent pIsospectral
##         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;          &lt;dbl&gt;        &lt;dbl&gt;
## 1       0.025 -0.338    0.194 0.00666        0.00551        0.105
## 2       0.25  -0.176    0.483 0.147          0.152          0.393
## 3       0.5   -0.0584   0.676 0.395          0.411          0.625
## 4       0.75   0.0444   0.837 0.672          0.722          0.843
## 5       0.975  0.170    0.985 0.971          0.982          0.988</code></pre>
</div>
<div id="plotting-the-results" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Plotting the results</h2>
<p>This gives us a first order sense of the results, but let’s use the <code>plotCorEns</code> function to dig in deeper.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="age-uncertain-correlation.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCorEns</span>(corout,</span>
<span id="cb7-2"><a href="age-uncertain-correlation.html#cb7-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.position =</span><span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">8</span>),</span>
<span id="cb7-3"><a href="age-uncertain-correlation.html#cb7-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">f.sig.lab.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">6</span>),</span>
<span id="cb7-4"><a href="age-uncertain-correlation.html#cb7-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">significance.option =</span> <span class="st">&quot;raw&quot;</span>,</span>
<span id="cb7-5"><a href="age-uncertain-correlation.html#cb7-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">use.fdr =</span> <span class="cn">FALSE</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Distribution of correlation coefficients&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-3-1.png" width="576" /></p>
<div id="significance-testing-options" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Significance testing options</h3>
<p>OK, here we see the distribution of correlation coefficients, and their significance.
Note that we chose “significance.option = ‘raw’,” so in green we see the distribution of significant correlations as determined by a standard T-test, without any consideration of autocorrelation.
In this case, we observe that 13.5% of the correlations are signficant.
Of course we know this is a very simplistic approach, and that with many paleoclimate datasets we must consider the impact of temporal autocorrelation, which can readily cause spurious correlations.
geoChronR addresses this point using three approaches, which are elaborated on in the <a href="https://doi.org/10.5194/gchron-2020-25">geoChronR manuscript</a>, and summarized here:</p>
<ol style="list-style-type: decimal">
<li><p>The simplest approach (“eff-n”) is to adjust the test’s sample size to reflect the reduction in degrees of freedom due to autocorrelation.</p></li>
<li><p>Alternatively, the “isopersistent” option will generate surrogates, or random synthetic timeseries, that emulate the persistence characteristics of the series, and use those to estiamte significance.</p></li>
<li><p>The final option, “isospectral” also generates surrogates to estimate significance, but does so by scrambling the spectral phases of the two datasets, thus preserving their power spectrum while destroying the correlated signal.</p></li>
</ol>
<p>Let’s take a look at each of these three options,</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="age-uncertain-correlation.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCorEns</span>(corout,</span>
<span id="cb8-2"><a href="age-uncertain-correlation.html#cb8-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.position =</span><span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">8</span>),</span>
<span id="cb8-3"><a href="age-uncertain-correlation.html#cb8-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">f.sig.lab.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">6</span>),</span>
<span id="cb8-4"><a href="age-uncertain-correlation.html#cb8-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">significance.option =</span> <span class="st">&quot;eff-n&quot;</span>,</span>
<span id="cb8-5"><a href="age-uncertain-correlation.html#cb8-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">use.fdr =</span> <span class="cn">FALSE</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Effective-N significance testing&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-4-1.png" width="576" /></p>
<p>Here we see a dramatic effect of accounting for serial autocorrelation in our significance testing. Using the “effective-N” method drops the percentage of significant correlations (at the 0.05 level) to 0. However when autocorrelation is large, this approach dramatically reduces the effective degrees of freedom and has been shown to be overly conservative in many cases. So let’s take a look at the surrogate-based approaches.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="age-uncertain-correlation.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCorEns</span>(corout,</span>
<span id="cb9-2"><a href="age-uncertain-correlation.html#cb9-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.position =</span><span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">8</span>),</span>
<span id="cb9-3"><a href="age-uncertain-correlation.html#cb9-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">f.sig.lab.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">6</span>),</span>
<span id="cb9-4"><a href="age-uncertain-correlation.html#cb9-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">significance.option =</span> <span class="st">&quot;isopersistent&quot;</span>,</span>
<span id="cb9-5"><a href="age-uncertain-correlation.html#cb9-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">use.fdr =</span> <span class="cn">FALSE</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Isopersistent significance testing&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-5-1.png" width="576" /></p>
<p>Using the “isopersistent” approach, where we simulate thousands of synthetic correlations with the same autocorrelation characteristics as the real data, and see how frequently we observe r-values at the observed levels, gives a much less conservative result. In this case the fraction of significant correlations is only slightly smaller than when not accounting for autocorrelation at all.</p>
<p>This is a good point to note that we have another statistical problem on our hands. In addition to the impact of autocorrelation on this analysis, repeating the test over multiple ensemble members raises the issue of test multiplicity <span class="citation">(<a href="#ref-Ventura2004" role="doc-biblioref"><strong>Ventura2004?</strong></a>)</span>, or the “look elsewhere effect.”
At a 5% significance level, one would expect a 1000 member ensemble to contain 50 spurious “discoveries” – instances of the null hypothesis, here “no correlation” being rejected.
To overcome this problem, we control for this false discovery rate (FDR) using the simple approach of <span class="citation">(<a href="#ref-BenjaminiHochberg95" role="doc-biblioref"><strong>BenjaminiHochberg95?</strong></a>)</span>, coded in R by <span class="citation">(<a href="#ref-Ventura2004" role="doc-biblioref"><strong>Ventura2004?</strong></a>)</span>.
FDR takes this effect into account to minimize the risk of identifying such spurious correlations merely on account of repeated testing.
In effect, it filters the set of “significant” results identified by each hypothesis test (effective-N, isopersistent, or isospectral).
Let’s plot this again, but turn the <code>use.fdr</code> option to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="age-uncertain-correlation.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCorEns</span>(corout,</span>
<span id="cb10-2"><a href="age-uncertain-correlation.html#cb10-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.position =</span><span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">8</span>),</span>
<span id="cb10-3"><a href="age-uncertain-correlation.html#cb10-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">f.sig.lab.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">6</span>),</span>
<span id="cb10-4"><a href="age-uncertain-correlation.html#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">significance.option =</span> <span class="st">&quot;isopersistent&quot;</span>,</span>
<span id="cb10-5"><a href="age-uncertain-correlation.html#cb10-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">use.fdr =</span> <span class="cn">TRUE</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Isopersistent significance testing, with False Discovery Rate effects&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-6-1.png" width="576" /></p>
<p>Now we see how accounting for FDR can further reduce our significance levels. In this case, all but a small fraction of the significant correlations are expected due to test multiplicity - the randomness that we’re sampling by repeating the correlation across 1000 ensemble members. After acccounting for this, only 0.7% of the ensemble members are significant.</p>
<p>Note that accounting for False Discovery Rate is a separate process than deriving p-values, and can be applied to any of the significance.options in geoChronR. For our final example we’ll take a look at isospectral significance testing and account for FDR.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="age-uncertain-correlation.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotCorEns</span>(corout,</span>
<span id="cb11-2"><a href="age-uncertain-correlation.html#cb11-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.position =</span><span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">8</span>),</span>
<span id="cb11-3"><a href="age-uncertain-correlation.html#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">f.sig.lab.position =</span> <span class="fu">c</span>(.<span class="dv">85</span>,.<span class="dv">6</span>),</span>
<span id="cb11-4"><a href="age-uncertain-correlation.html#cb11-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">significance.option =</span> <span class="st">&quot;isospectral&quot;</span>,</span>
<span id="cb11-5"><a href="age-uncertain-correlation.html#cb11-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">use.fdr =</span> <span class="cn">TRUE</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="st">&quot;Isospectral significance testing&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-7-1.png" width="576" /></p>
<p>In the isospectral test, only a few of the ensembles members are significant, none of which remain upon adjusting for FDR.
This method makes the fewest assumptions as to the structure of the series, and its computational cost is moderate, and so it is the default in geoChronR.
We also recommend including FDR adjustment to avoid test-multiplicitly corrections.</p>
</div>
</div>
<div id="judging-the-overall-significance-of-an-age-uncertain-correlation" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Judging the overall significance of an age-uncertain correlation</h2>
<p>So, with all of the methods, only a small subset of the correlations are significant, so it’s probably fair to say to that this is not a significant correlation after accounting for age uncertainty.
But this begs the question, what fraction of the correlation ensemble needs to be significant to consider an age-uncertain relation significant?
There is no hard and fast theoretical justification for what fraction of ensemble correlation results should be expected to pass such a significance test, and so evaluating the significance of age uncertain correlation remains somewhat subjective.
Indeed, two truly correlated timeseries, when afflicted with age uncertainty, will commonly return some fraction of insignificant results when random ensemble members are correlated against each other.
The frequency of these “false negatives” depends on the structure of the age uncertainties and the timeseries, and will vary to some extent by random chance.
One way to get a sense of the vulnerability of a timeseries to false negatives is to perform an age-uncertain correlation of a dataset with itself.
It is appropriate to consider the results of this analysis as a best-case scenario, and to consider the correlation results in this light.
For illustration, we perform this calculation with the Hulu Cave <span class="math inline">\(\delta^{18}\)</span>O record</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="age-uncertain-correlation.html#cb12-1" aria-hidden="true" tabindex="-1"></a>coroutHulu <span class="ot">&lt;-</span> <span class="fu">corEns</span>(hulu.ae,hulu.d18O,hulu.ae,hulu.d18O,<span class="at">bin.step =</span> <span class="dv">200</span>,<span class="at">max.ens =</span> <span class="dv">1000</span>)</span>
<span id="cb12-2"><a href="age-uncertain-correlation.html#cb12-2" aria-hidden="true" tabindex="-1"></a>corPlotHulu <span class="ot">&lt;-</span> <span class="fu">plotCorEns</span>(coroutHulu,</span>
<span id="cb12-3"><a href="age-uncertain-correlation.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.8</span>),</span>
<span id="cb12-4"><a href="age-uncertain-correlation.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">significance.option =</span> <span class="st">&quot;isospectral&quot;</span>)<span class="sc">+</span><span class="fu">ggtitle</span>(<span class="cn">NULL</span>)</span>
<span id="cb12-5"><a href="age-uncertain-correlation.html#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="age-uncertain-correlation.html#cb12-6" aria-hidden="true" tabindex="-1"></a>above90 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sum</span>(coroutHulu<span class="sc">$</span>cor.df<span class="sc">$</span>r <span class="sc">&gt;</span> <span class="fl">0.9</span>)<span class="sc">/</span><span class="fu">nrow</span>(coroutHulu<span class="sc">$</span>cor.df)<span class="sc">*</span><span class="dv">100</span>,<span class="dv">1</span>)</span>
<span id="cb12-7"><a href="age-uncertain-correlation.html#cb12-7" aria-hidden="true" tabindex="-1"></a>med <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">median</span>(coroutHulu<span class="sc">$</span>cor.df<span class="sc">$</span>r),<span class="dv">2</span>)</span>
<span id="cb12-8"><a href="age-uncertain-correlation.html#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="age-uncertain-correlation.html#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corPlotHulu)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-8-1.png" width="576" /></p>
<p>The impact of age uncertainty on the correlation of this record is apparent; even when correlated against itself, only 3.1% of the ensembles have r-values greater than 0.9, and the median correlation is 0.8.
However, all of the correlations remain significant, even after accounting for autocorrelation, indicating that age uncertainty and the structure of the timeseries does not preclude the possibility of significant correlations.</p>
</div>
<div id="conclusions" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Conclusions</h2>
<p>So, to wrap up, generally, age uncertainties obscure relationships between records, while in rare cases creating the appearance of spurious correlations. It is appropriate to think of the ensemble correlation results produced by geoChronR as a first-order estimate of the age-uncertain correlation characteristics between timeseries, rather than a binary answer to the question “Are these two datasets significantly correlated?”
However, as a rule of thumb, if more than half of the ensemble correlation results are significant, it is reasonable to characterize that correlation as robust to age uncertainty.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="inputs.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="exercise-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Time-uncertain data analysis in R.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>

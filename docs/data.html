<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data in geoChronR | Time-uncertain data analysis in R</title>
  <meta name="description" content="This book covers time-uncertain data analysis in R, primarily relying on the geoChronR package" />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data in geoChronR | Time-uncertain data analysis in R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book covers time-uncertain data analysis in R, primarily relying on the geoChronR package" />
  <meta name="github-repo" content="linkedearth/time-uncertain-data-analysis-in-R" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data in geoChronR | Time-uncertain data analysis in R" />
  
  <meta name="twitter:description" content="This book covers time-uncertain data analysis in R, primarily relying on the geoChronR package" />
  

<meta name="author" content="Nick McKay" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="installation.html"/>
<link rel="next" href="age-modelling-in-geochronr.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">geoChronR Tutorial</a></li>
<li><a href="http://nickmckay.github.io/GeoChronR>geoChronR manual</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installing the software you need</a>
<ul>
<li class="chapter" data-level="2.1" data-path="installation.html"><a href="installation.html#installing-lipdr"><i class="fa fa-check"></i><b>2.1</b> Installing lipdR</a></li>
<li class="chapter" data-level="2.2" data-path="installation.html"><a href="installation.html#installing-geochronr"><i class="fa fa-check"></i><b>2.2</b> Installing geoChronR</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data in geoChronR</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#loading-a-lipd-file"><i class="fa fa-check"></i><b>3.1</b> Loading a LiPD file</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data.html"><a href="data.html#selectData"><i class="fa fa-check"></i><b>3.1.1</b> Extract a variable from a LiPD object</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#loading-multiple-lipd-datasets"><i class="fa fa-check"></i><b>3.2</b> Loading multiple LiPD datasets</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html"><i class="fa fa-check"></i><b>4</b> Age modelling in geoChronR</a>
<ul>
<li class="chapter" data-level="4.1" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#bacon"><i class="fa fa-check"></i><b>4.1</b> Bacon</a></li>
<li class="chapter" data-level="4.2" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#bchron"><i class="fa fa-check"></i><b>4.2</b> Bchron</a></li>
<li class="chapter" data-level="4.3" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#oxcal"><i class="fa fa-check"></i><b>4.3</b> Oxcal</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#lets-compare-these-models."><i class="fa fa-check"></i><b>4.3.1</b> Let’s compare these models.</a></li>
<li class="chapter" data-level="4.3.2" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#creating-a-multimodel-ensemble"><i class="fa fa-check"></i><b>4.3.2</b> Creating a multimodel ensemble</a></li>
<li class="chapter" data-level="4.3.3" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#mapping-the-age-ensemble-to-the-paleodata-measurements"><i class="fa fa-check"></i><b>4.3.3</b> Mapping the age ensemble to the paleoData measurements</a></li>
<li class="chapter" data-level="4.3.4" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#creating-a-timeseries-plot-as-a-spaghetti-plot-of-lines"><i class="fa fa-check"></i><b>4.3.4</b> Creating a timeseries plot as a spaghetti plot of lines</a></li>
<li class="chapter" data-level="4.3.5" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#creating-a-timeseries-plot-with-a-ribbon-confidence-intervals"><i class="fa fa-check"></i><b>4.3.5</b> Creating a timeseries plot with a ribbon confidence intervals</a></li>
<li class="chapter" data-level="4.3.6" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#combining-the-two-kinds-of-timeseries-plots"><i class="fa fa-check"></i><b>4.3.6</b> Combining the two kinds of timeseries plots</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#banded-age-modelling"><i class="fa fa-check"></i><b>4.4</b> Banded Age Modelling</a></li>
<li class="chapter" data-level="4.5" data-path="age-modelling-in-geochronr.html"><a href="age-modelling-in-geochronr.html#chapter-project."><i class="fa fa-check"></i><b>4.5</b> Chapter project.</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html"><i class="fa fa-check"></i><b>5</b> Age-uncertain correlation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#the-corens-function"><i class="fa fa-check"></i><b>5.1</b> The corEns() function</a></li>
<li class="chapter" data-level="5.2" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#plotting-the-results"><i class="fa fa-check"></i><b>5.2</b> Plotting the results</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#significance-testing-options"><i class="fa fa-check"></i><b>5.2.1</b> Significance testing options</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#judging-the-overall-significance-of-an-age-uncertain-correlation"><i class="fa fa-check"></i><b>5.3</b> Judging the overall significance of an age-uncertain correlation</a></li>
<li class="chapter" data-level="5.4" data-path="age-uncertain-correlation.html"><a href="age-uncertain-correlation.html#conclusions"><i class="fa fa-check"></i><b>5.4</b> Conclusions</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html"><i class="fa fa-check"></i><b>6</b> Regression and Calibration-in-time</a>
<ul>
<li class="chapter" data-level="6.1" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#load-the-lipd-file"><i class="fa fa-check"></i><b>6.1</b> Load the LiPD file</a></li>
<li class="chapter" data-level="6.2" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#check-out-the-contents"><i class="fa fa-check"></i><b>6.2</b> Check out the contents</a></li>
<li class="chapter" data-level="6.3" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#create-an-age-model-with-bacon"><i class="fa fa-check"></i><b>6.3</b> Create an age model with Bacon</a></li>
<li class="chapter" data-level="6.4" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#and-plot-the-ensemble-output"><i class="fa fa-check"></i><b>6.4</b> And plot the ensemble output</a></li>
<li class="chapter" data-level="6.5" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#map-the-age-ensemble-to-the-paleodata-table"><i class="fa fa-check"></i><b>6.5</b> Map the age ensemble to the paleodata table</a></li>
<li class="chapter" data-level="6.6" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#select-the-paleodata-age-ensemble-and-rabd-data-that-wed-like-to-regress-and-calibrate"><i class="fa fa-check"></i><b>6.6</b> Select the paleodata age ensemble, and RABD data that we’d like to regress and calibrate</a></li>
<li class="chapter" data-level="6.7" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#now-load-in-the-instrumental-data-we-want-to-correlate-and-regress-agains"><i class="fa fa-check"></i><b>6.7</b> Now load in the instrumental data we want to correlate and regress agains</a></li>
<li class="chapter" data-level="6.8" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#check-agetime-units-before-proceeding"><i class="fa fa-check"></i><b>6.8</b> Check age/time units before proceeding</a></li>
<li class="chapter" data-level="6.9" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#create-a-variable-list-for-the-instrumental-data"><i class="fa fa-check"></i><b>6.9</b> Create a “variable list” for the instrumental data</a></li>
<li class="chapter" data-level="6.10" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#calculate-an-ensmeble-correlation-between-the-rabd-and-local-summer-temperature-data"><i class="fa fa-check"></i><b>6.10</b> Calculate an ensmeble correlation between the RABD and local summer temperature data</a></li>
<li class="chapter" data-level="6.11" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#and-plot-the-output"><i class="fa fa-check"></i><b>6.11</b> And plot the output</a></li>
<li class="chapter" data-level="6.12" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#perform-ensemble-regression"><i class="fa fa-check"></i><b>6.12</b> Perform ensemble regression</a></li>
<li class="chapter" data-level="6.13" data-path="regression-and-calibration-in-time.html"><a href="regression-and-calibration-in-time.html#and-plot-the-output-1"><i class="fa fa-check"></i><b>6.13</b> And plot the output</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spectral-analysis.html"><a href="spectral-analysis.html"><i class="fa fa-check"></i><b>7</b> Spectral Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="spectral-analysis.html"><a href="spectral-analysis.html#time-certain-spectral-analysis"><i class="fa fa-check"></i><b>7.1</b> Time-certain spectral analysis</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="spectral-analysis.html"><a href="spectral-analysis.html#lomb-scargle-periodogram"><i class="fa fa-check"></i><b>7.1.1</b> Lomb-Scargle periodogram</a></li>
<li class="chapter" data-level="7.1.2" data-path="spectral-analysis.html"><a href="spectral-analysis.html#multi-taper-method"><i class="fa fa-check"></i><b>7.1.2</b> Multi-taper Method</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spectral-analysis.html"><a href="spectral-analysis.html#time-uncertain-spectral-analysis"><i class="fa fa-check"></i><b>7.2</b> Time-uncertain spectral analysis</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html"><i class="fa fa-check"></i><b>8</b> Principal Components Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#make-a-map"><i class="fa fa-check"></i><b>8.1</b> Make a map</a></li>
<li class="chapter" data-level="8.2" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#prepare-the-data-for-pca"><i class="fa fa-check"></i><b>8.2</b> Prepare the data for PCA</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#grab-the-age-ensembles-for-each-record."><i class="fa fa-check"></i><b>8.2.1</b> Grab the age ensembles for each record.</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#calculate-the-ensemble-pca"><i class="fa fa-check"></i><b>8.3</b> Calculate the ensemble PCA</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#plot-the-ensemble-pca-results"><i class="fa fa-check"></i><b>8.3.1</b> Plot the ensemble PCA results</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="principal-components-analysis.html"><a href="principal-components-analysis.html#ensemble-pca-take-two---using-a-covariance-matrix."><i class="fa fa-check"></i><b>8.4</b> Ensemble PCA take two - using a covariance matrix.</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Time-uncertain data analysis in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data" class="section level1" number="3">
<h1><span class="header-section-number">Chapter 3</span> Data in geoChronR</h1>
<p>geoChronR was designed for data structured in the <a href="http://lipd.net">LiPD format</a>.
Actually, much of the LiPD framework was developed to accommodate the needs of geoChronR, so by far, you’ll find it easiest to work with data in the structured, metadata-rich LiPD format.
All of the examples and exercises in this book will use LiPD datasets.
If you have data you want to analyze in geoChronR, the best and easiest way to get those data into the LiPD format is at the <a href="http://lipd.net/playground">LiPD playground</a>.
It takes some time to learn the structure, and some time to annotate your data, but it will save you time down the road.
If you <strong>really</strong> don’t want to lipdify your data, we are working on ways to take advantage of geoChronR tools with simpler data structures.
This will mean more work in geoChronR, since you’ll have to specify a lot information that would normally be included in a LiPD file, but there are times when this makes sense.
Once this functionality is operable, we’ll add a module demonstrating how this works.</p>
<div id="loading-a-lipd-file" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Loading a LiPD file</h2>
<p>Now you can load the lipdR library, and load some data.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lipdR)</span>
<span id="cb1-2"><a href="data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoChronR)</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;spatstat.geom&#39;:
##   method     from
##   print.boxx cli</code></pre>
<pre><code>## Welcome to geoChronR version 1.0.14!</code></pre>
<pre><code>## </code></pre>
<pre><code>## 
## Attaching package: &#39;geoChronR&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:lipdR&#39;:
## 
##     createTSid, pullTsVariable</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">readLipd</span>(<span class="st">&quot;https://lipdverse.org/Temp12k/current_version/GEOFAR_KF16_MgCa.Repschlager.2016.lpd&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;reading: GEOFAR_KF16_MgCa.Repschlager.2016.lpd&quot;</code></pre>
<p>You can load a LiPD file from the web, as shown above, or locally on your computer. If you leave the input blank (e.g. <code>L &lt;- readLipd()</code>), you can interactively choose a file on your computer.</p>
<div class="blackbox">
<div class="exercise">
<p><span id="exr:LoadingLipdData" class="exercise"><strong>Exercise 3.1  </strong></span>Explore <a href="https://lipdverse.org/Temp12k/current_version">the Temp12k collection on lipdverse.org</a>, and load a file into R using lipdR with two different approaches: a) directly using the url as above, and b) download the file to your computer, and load it interactively.</p>
</div>
</div>
<details>
<summary>
Click for Answer to <a href="data.html#exr:LoadingLipdData">3.1</a>a
</summary>
<p>We’ll use <a href="https://lipdverse.org/Temp12k/current_version/HeshangCave.Wang.2018.html">this dataset</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>First we’ll get it directly from the web like this:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data.html#cb9-1" aria-hidden="true" tabindex="-1"></a>    lipd <span class="ot">&lt;-</span> <span class="fu">readLipd</span>(<span class="st">&quot;https://lipdverse.org/Temp12k/current_version/HeshangCave.Wang.2018.lpd&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;reading: HeshangCave.Wang.2018.lpd&quot;</code></pre>
note that the extension is “.lpd” not “.html”
</details>
<details>
<summary>
Click for Answer to <a href="data.html#exr:LoadingLipdData">3.1</a>b
</summary>
<ol start="2" style="list-style-type: lower-alpha">
<li>This time, just go to <a href="https://lipdverse.org/Temp12k/current_version/HeshangCave.Wang.2018.html">the dataset</a> and download the data to your computer, then run</li>
</ol>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data.html#cb11-1" aria-hidden="true" tabindex="-1"></a>    lipd <span class="ot">&lt;-</span> <span class="fu">readLipd</span>()</span></code></pre></div>
and select the file interactively.
</details>
<p>Once you have a LiPD object loaded in R, there are a few things you can do. First, if you want a quick and dirty visualization of what’s inside the dataset, use <code>plotLipd()</code>.</p>
<p>If you know what the variables are you want to plot beforehand, you can specify them like this:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotSummary</span>(L,<span class="at">paleo.data.var =</span> <span class="st">&quot;temperature&quot;</span>,<span class="at">chron.age.var =</span> <span class="st">&quot;age&quot;</span>,<span class="at">chron.depth.var =</span> <span class="st">&quot;depthMid&quot;</span>,<span class="at">chron.age.14c.var =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Found it! Moving on...&quot;
## [1] &quot;Found it! Moving on...&quot;
## [1] &quot;Found it! Moving on...&quot;
## [1] &quot;Found it! Moving on...&quot;</code></pre>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<pre><code>## TableGrob (4 x 4) &quot;arrange&quot;: 4 grobs
##   z     cells    name                 grob
## 1 1 (1-1,1-2) arrange gTree[GRID.gTree.11]
## 2 2 (1-2,3-4) arrange       gtable[layout]
## 3 3 (2-4,1-2) arrange       gtable[layout]
## 4 4 (3-4,3-4) arrange       gtable[layout]</code></pre>
<p>But most of the time, you’ll just run it in interactive mode and select what you want.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotSummary</span>(lipd)</span></code></pre></div>
<p>One of the components of <code>plotSummary()</code> is a site map, which is created with the function <code>mapLipd()</code>.</p>
<div class="blackbox">
<div class="exercise">
<p><span id="exr:mapLipd" class="exercise"><strong>Exercise 3.2  </strong></span>Check out the documentation for <code>mapLipd()</code> (type <code>?mapLipd</code>), and tinker with the options to produce different types of maps.</p>
</div>
</div>
<div id="selectData" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Extract a variable from a LiPD object</h3>
<p>In geoChronR, it is often useful to extract one or two variables from a LiPD object and then use them for subsequent analysis and visualization. The key function for this is <code>selectData()</code>. Typically, you’ll use it interactive mode to find the variable your looking for, either in the paleoData or chronData sections of the LiPD file.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co">#grab the calibrated temperature record</span></span>
<span id="cb16-2"><a href="data.html#cb16-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">selectData</span>(L,<span class="at">paleo.or.chron =</span> <span class="st">&quot;paleoData&quot;</span>)</span>
<span id="cb16-3"><a href="data.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="data.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co">#grab the original dates from the chronData</span></span>
<span id="cb16-5"><a href="data.html#cb16-5" aria-hidden="true" tabindex="-1"></a>c14 <span class="ot">&lt;-</span> <span class="fu">selectData</span>(L,<span class="at">paleo.or.chron =</span> <span class="st">&quot;chronData&quot;</span>)</span></code></pre></div>
<p>If there’s a lot of variables in the file, and you kinda know what you’re looking for, you can add a <code>var.name</code> guess and it will narrow it down to options that seem likely, or select one automatically if it’s close.</p>
<div class="blackbox">
<div class="exercise">
<p><span id="exr:mapLipd" class="exercise"><strong>Exercise 3.2  </strong></span>Enter “d18o” as the var.name in selectData() and see how it narrows down your options.</p>
</div>
</div>
<p>Of course, you can also specify all of the options in <code>selectData()</code>, and then get exactly what you want non interactively. This includes data from model ensembleTables or summaryTables, in addition to the measurementTables you use more frequently. For example:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data.html#cb17-1" aria-hidden="true" tabindex="-1"></a>mgCa  <span class="ot">&lt;-</span> <span class="fu">selectData</span>(L,<span class="at">var.name =</span> <span class="st">&quot;mg/ca&quot;</span>,<span class="at">paleo.or.chron =</span> <span class="st">&quot;paleoData&quot;</span>,<span class="at">table.type =</span> <span class="st">&quot;meas&quot;</span>,<span class="at">meas.table.num =</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Found it! Moving on...&quot;</code></pre>
</div>
</div>
<div id="loading-multiple-lipd-datasets" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Loading multiple LiPD datasets</h2>
<p>In addition to loading single files, <code>readLipd()</code> can also load a whole directory, or a url that points to a zip file full of files.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data.html#cb19-1" aria-hidden="true" tabindex="-1"></a>eur <span class="ot">&lt;-</span> <span class="fu">readLipd</span>(<span class="st">&quot;https://lipdverse.org/geoChronR-examples/euro/Euro2k.zip&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;reading: Arc-AkademiiNaukIceCap.Opel.2013.lpd&quot;
## [1] &quot;reading: Arc-Forfjorddalen.McCarroll.2013.lpd&quot;
## [1] &quot;reading: Arc-GulfofAlaska.Wilson.2014.lpd&quot;
## [1] &quot;reading: Arc-Indigirka.Hughes.1999.lpd&quot;
## [1] &quot;reading: Arc-Jamtland.Wilson.2016.lpd&quot;
## [1] &quot;reading: Arc-Kittelfjall.Bjorklund.2012.lpd&quot;
## [1] &quot;reading: Arc-PolarUrals.Wilson.2015.lpd&quot;
## [1] &quot;reading: Arc-Tjeggelvas.Bjorklund.2012.lpd&quot;
## [1] &quot;reading: Arc-Tornetrask.Melvin.2012.lpd&quot;
## [1] &quot;reading: Eur-CentralandEasternPyrenees.Pla.2004.lpd&quot;
## [1] &quot;reading: Eur-CentralEurope.Dobrovoln.2009.lpd&quot;
## [1] &quot;reading: Eur-CoastofPortugal.Abrantes.2011.lpd&quot;
## [1] &quot;reading: Eur-EasternCarpathianMountains.Popa.2008.lpd&quot;
## [1] &quot;reading: Eur-EuropeanAlps.Bntgen.2011.lpd&quot;
## [1] &quot;reading: Eur-FinnishLakelands.Helama.2014.lpd&quot;
## [1] &quot;reading: Eur-LakeSilvaplana.Larocque-Tobler.2010.lpd&quot;
## [1] &quot;reading: Eur-LakeSilvaplana.Trachsel.2010.lpd&quot;
## [1] &quot;reading: Eur-Ltschental.Bntgen.2006.lpd&quot;
## [1] &quot;reading: Eur-MaritimeFrenchAlps.Bntgen.2012.lpd&quot;
## [1] &quot;reading: Eur-NorthernScandinavia.Esper.2012.lpd&quot;
## [1] &quot;reading: Eur-NorthernSpain.Martn-Chivelet.2011.lpd&quot;
## [1] &quot;reading: Eur-RAPiD-17-5P.Moffa-Sanchez.2014.lpd&quot;
## [1] &quot;reading: Eur-Seebergsee.Larocque-Tobler.2012.lpd&quot;
## [1] &quot;reading: Eur-SpanishPyrenees.Dorado-Linan.2012.lpd&quot;
## [1] &quot;reading: Eur-SpannagelCave.Mangini.2005.lpd&quot;
## [1] &quot;reading: Eur-Stockholm.Leijonhufvud.2009.lpd&quot;
## [1] &quot;reading: Eur-Tallinn.Tarand.2001.lpd&quot;
## [1] &quot;reading: Eur-TatraMountains.Bntgen.2013.lpd&quot;
## [1] &quot;reading: Ocn-AqabaJordanAQ18.Heiss.1999.lpd&quot;
## [1] &quot;reading: Ocn-AqabaJordanAQ19.Heiss.1999.lpd&quot;
## [1] &quot;reading: Ocn-RedSea.Felis.2000.lpd&quot;</code></pre>
<p>If you load multiple files, it will create an object called a “multi-lipd,” which is just a list of lipd objects. And we can use some of the same functions.</p>
<p>For example, let’s make a map of our multi-lipd object:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapLipd</span>(eur,<span class="at">projection =</span> <span class="st">&quot;mollweide&quot;</span>,<span class="at">global =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-10-1.png" width="672" />
These multi-lipd objects are convenient for getting a lot of data into R, but trying to work with the data inside can get pretty tricky pretty fast. When working with multiple datasets, you’ll almost always want to create a timeseries (TS) object, or formally a “lipd-ts” object. You can do that using the ‘extractTs()’ function or ’as.lipdTs()` from the lipdR package.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data.html#cb22-1" aria-hidden="true" tabindex="-1"></a>TS <span class="ot">&lt;-</span> <span class="fu">extractTs</span>(eur)</span>
<span id="cb22-2"><a href="data.html#cb22-2" aria-hidden="true" tabindex="-1"></a>TS <span class="ot">&lt;-</span> <span class="fu">as.lipdTs</span>(eur)</span></code></pre></div>
<p>The LiPD-TS object is a “flattened” version of the dataset, it’s much less hierarchical and each entry corresponds to a column in a table. By default, <code>extractTs()</code> will get all the variables in measurementTables in paleoData objects, but you can also get variables from other tables and from the chronData objects by changing the options. See <code>?extractTs</code> for details.</p>
<p>Now we can use the TS version of plotSummary to summarize the whole collection of data.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data.html#cb23-1" aria-hidden="true" tabindex="-1"></a>summ <span class="ot">&lt;-</span> <span class="fu">plotSummaryTs</span>(TS,<span class="at">age.var =</span> <span class="st">&quot;year&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-12-1.png" width="672" />
:::: {.blackbox data-latex=""}
::: {.exercise #plotSummaryTs}
Explore the options in plotSummary. Create a new version that colors the dots and availability plot by PAGES 2k Region (the variable name is geo_pages2kRegion)
:::
::::</p>
<p>Although LiPD-TS objects are more convenient to work with, they’re still list-based and difficult to explore visually. If you’re used to working in the <a href="http://tidyverse.org">tidyverse</a> framework, you’ll likely find it useful to convert the data into a tibble (a type of data.frame). In lipdR, this is a “lipd-ts-tibble” object, but it’s also just a tibble, so it unlocks many, many options in RStudio and tidyverse.</p>
<p>To do so, use the <code>ts2tibble()</code> or <code>as.lipdTsTibble()</code> functions to create tibble.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data.html#cb24-1" aria-hidden="true" tabindex="-1"></a>ts.tib <span class="ot">&lt;-</span> <span class="fu">ts2tibble</span>(TS)</span></code></pre></div>
<p>If you’re in RStudio, you can now explore the contents of the object grapically. This produces a large tibble, so it’s still a little unwieldy. Importantly, some of the columns are nested (depth, age, year, paleoData_values), so all of the timeseries data are included in each row, for each timeseries. You can learn more about <a href="https://tidyr.tidyverse.org/articles/nest.html">nested tibbles here</a>.</p>
<p>As the tidyverse has grown, we’ve increasingly moved our lipdR and geoChronR workflows into this model. Take a look at how this unlocks some pretty efficient workflows.</p>
<div id="filtering" class="section level4" number="3.2.0.1">
<h4><span class="header-section-number">3.2.0.1</span> Filtering</h4>
<p>It’s often the case that the a collection of LiPD files includes far more data than we actually need. Let’s use <code>dplyr</code> to get just the data we need. Let’s say that we only want variables that are European tree ring data that were used in Pages2k. You can explore the variables in the data.frame, and the values in each field, and then compose an expression:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data.html#cb29-1" aria-hidden="true" tabindex="-1"></a>filtered.tib <span class="ot">&lt;-</span> ts.tib <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="data.html#cb29-2" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="fu">between</span>(geo_latitude,<span class="dv">30</span>,<span class="dv">80</span>) <span class="sc">&amp;</span> <span class="fu">between</span>(geo_longitude,<span class="sc">-</span><span class="dv">30</span>,<span class="dv">60</span>)) <span class="sc">%&gt;%</span> <span class="co">#restrict the coordinates to just Europe</span></span>
<span id="cb29-3"><a href="data.html#cb29-3" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(archiveType <span class="sc">==</span> <span class="st">&quot;tree&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="data.html#cb29-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(paleoData_useInGlobalTemperatureAnalysis <span class="sc">==</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Let’s take a look at the result!</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data.html#cb30-1" aria-hidden="true" tabindex="-1"></a>nTS <span class="ot">&lt;-</span> <span class="fu">as.lipdTs</span>(filtered.tib) <span class="co">#convert it back (for now)</span></span>
<span id="cb30-2"><a href="data.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plotSummaryTs</span>(nTS,<span class="at">age.var =</span> <span class="st">&quot;year&quot;</span>,<span class="at">f =</span> .<span class="dv">1</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<pre><code>## TableGrob (5 x 3) &quot;arrange&quot;: 2 grobs
##   z     cells    name           grob
## 1 1 (1-3,1-3) arrange gtable[layout]
## 2 2 (4-5,1-3) arrange gtable[layout]</code></pre>
<p>Great, it looks like our filtering worked! It looks like most of the data go back about 1000 years, but a few records are much longer. Next, we’d like to restrict our analysis to just 1000 - 2000 AD. This is possible in a nested tibble, but it’s often useful to have a longer version, one where every row in the data.frame corresponds to a single year-value pair, rather than a whole timeseries. This is the purpose of lipd-ts-tibble-long objects, the final lipd object type. This is useful if you want easy access to all the data in one large tibble.</p>
<p>We can convert our data to this structure using <code>tidyTs()</code> or, you guessed it, <code>as.lipdTsTibbleLong()</code></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data.html#cb32-1" aria-hidden="true" tabindex="-1"></a>longTib <span class="ot">&lt;-</span> <span class="fu">as.lipdTsTibbleLong</span>(filtered.tib) <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="data.html#cb32-2" aria-hidden="true" tabindex="-1"></a>   dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">between</span>(year,<span class="dv">1000</span>,<span class="dv">2000</span>))</span></code></pre></div>
<pre><code>## creating a lipdTsTibbleLong using year as the age.var</code></pre>
<p>Take a look at our new tibble, we restricted the time range, but it still has 11,350 rows! As you can imagine, loading in a few hundred LiPD datasets and converting them into lipd-ts-tibble-long objects will result in tibbles of several million rows, which might cause your computer problems!</p>
<p>Let’s take a quick look at these filtered data. The <code>plotTimeseriesStack()</code> function lets you make a quick version of the classic paleoclimate stack plots. Check out <a href="https://nickmckay.github.io/GeoChronR/articles/PlotTimeseriesStack.html">this tutorial</a> for a deep dive.</p>
<p>Here we’ll just plot our data, and color it by the proxy type.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotTimeseriesStack</span>(longTib,<span class="at">color.var =</span> <span class="st">&quot;paleoData_proxy&quot;</span>)</span></code></pre></div>
<p><img src="Time-uncertain-data-analysis-in-R_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>And there it is! Not too bad, but I don’t love that default colorscheme with only 3 values.</p>
<div class="blackbox">
<div class="exercise">
<p><span id="exr:plotTimeseriesStack" class="exercise"><strong>Exercise 3.3  </strong></span>Explore the options in plotTimeseriesStack. Create a new version that:</p>
<ol style="list-style-type: lower-alpha">
<li>Has better colors!</li>
<li>Changes the line thickness.</li>
<li>What does invert.var do?</li>
<li>Replot this, but only showing the MXD data.</li>
</ol>
</div>
</div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="installation.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="age-modelling-in-geochronr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Time-uncertain-data-analysis-in-R.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
